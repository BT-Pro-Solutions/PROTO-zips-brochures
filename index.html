<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brochures - Carriers, Wreckers, Trucks & Trailers</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="brochures-tabs">
        <a href="#" class="tab-item active" data-tab="equipment">
            Equipment Brochures
        </a>
        <a href="#" class="tab-item" data-tab="product">
            Product Brochures
        </a>
    </div>

    <div class="content-wrapper">
        <div class="tab-content">
            <div id="equipment-content" class="tab-panel active">
                <div class="brochures-container">
                    <div class="loading">Loading equipment brochures...</div>
                </div>
            </div>
            <div id="product-content" class="tab-panel">
                <div class="brochures-container">
                    <div class="loading">Loading product brochures...</div>
                </div>
            </div>
        </div>
        
        <div class="alphabet-nav" id="alphabet-nav">
            <!-- Alphabet letters will be generated by JavaScript -->
        </div>
    </div>

    <script>
        class BrochureManager {
            constructor() {
                this.data = null;
                this.activeTab = 'equipment';
                this.brandPositions = {}; // Store brand positions for alphabet nav
                this.availableLetters = new Set(); // Store available first letters
                this.init();
            }

            async init() {
                try {
                    await this.loadData();
                    this.setupTabs();
                    this.createAlphabetNav();
                    this.renderContent();
                    this.updateAlphabetAvailability();
                } catch (error) {
                    console.error('Failed to initialize brochure manager:', error);
                    this.showError('Failed to load brochure data');
                }
            }

            async loadData() {
                try {
                    const response = await fetch('brochures_data.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    this.data = await response.json();
                } catch (error) {
                    console.error('Error loading brochure data:', error);
                    throw error;
                }
            }

            setupTabs() {
                const tabItems = document.querySelectorAll('.tab-item');
                tabItems.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tabType = tab.getAttribute('data-tab');
                        this.switchTab(tabType);
                    });
                });
            }

            switchTab(tabType) {
                // Update active tab
                this.activeTab = tabType;
                
                // Update tab appearance
                document.querySelectorAll('.tab-item').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabType}"]`).classList.add('active');
                
                // Update content visibility
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(`${tabType}-content`).classList.add('active');
                
                // Update alphabet navigation availability
                this.updateAlphabetAvailability();
            }

            createAlphabetNav() {
                const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
                const alphabetNav = document.getElementById('alphabet-nav');
                
                alphabetNav.innerHTML = '';
                
                alphabet.forEach(letter => {
                    const letterElement = document.createElement('div');
                    letterElement.className = 'alphabet-letter';
                    letterElement.textContent = letter;
                    letterElement.setAttribute('data-letter', letter);
                    
                    letterElement.addEventListener('click', () => {
                        this.scrollToLetter(letter);
                    });
                    
                    alphabetNav.appendChild(letterElement);
                });
            }

            updateAlphabetAvailability() {
                if (!this.data) return;
                
                // Get current tab's brands
                const currentBrands = this.activeTab === 'equipment' 
                    ? this.data.equipmentBrochures 
                    : this.data.productBrochures;
                
                // Clear previous available letters
                this.availableLetters.clear();
                
                // Find available first letters
                Object.keys(currentBrands).forEach(brandName => {
                    const firstLetter = brandName.charAt(0).toUpperCase();
                    this.availableLetters.add(firstLetter);
                });
                
                // Update alphabet navigation
                document.querySelectorAll('.alphabet-letter').forEach(letterEl => {
                    const letter = letterEl.getAttribute('data-letter');
                    letterEl.classList.remove('available', 'unavailable');
                    
                    if (this.availableLetters.has(letter)) {
                        letterEl.classList.add('available');
                    } else {
                        letterEl.classList.add('unavailable');
                    }
                });
            }

            scrollToLetter(targetLetter) {
                // If the letter is available, scroll to it directly
                if (this.availableLetters.has(targetLetter)) {
                    const element = document.querySelector(`[data-brand-letter="${targetLetter}"]`);
                    if (element) {
                        element.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                        this.updateActiveAlphabetLetter(targetLetter);
                        return;
                    }
                }
                
                // Find the nearest available letter
                const availableLettersArray = Array.from(this.availableLetters).sort();
                let nearestLetter = null;
                
                for (const letter of availableLettersArray) {
                    if (letter >= targetLetter) {
                        nearestLetter = letter;
                        break;
                    }
                }
                
                // If no letter found after target, use the last available letter
                if (!nearestLetter && availableLettersArray.length > 0) {
                    nearestLetter = availableLettersArray[availableLettersArray.length - 1];
                }
                
                if (nearestLetter) {
                    const element = document.querySelector(`[data-brand-letter="${nearestLetter}"]`);
                    if (element) {
                        element.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                        this.updateActiveAlphabetLetter(nearestLetter);
                    }
                }
            }

            updateActiveAlphabetLetter(letter) {
                document.querySelectorAll('.alphabet-letter').forEach(el => {
                    el.classList.remove('active');
                });
                
                const activeLetterEl = document.querySelector(`[data-letter="${letter}"]`);
                if (activeLetterEl) {
                    activeLetterEl.classList.add('active');
                }
            }

            renderContent() {
                if (!this.data) return;

                this.renderEquipmentBrochures();
                this.renderProductBrochures();
            }

            renderEquipmentBrochures() {
                const container = document.querySelector('#equipment-content .brochures-container');
                const brands = this.data.equipmentBrochures;
                
                let html = '';
                
                // Sort brands alphabetically
                const sortedBrands = Object.keys(brands).sort();
                
                sortedBrands.forEach(brandName => {
                    const brochures = brands[brandName];
                    const firstLetter = brandName.charAt(0).toUpperCase();
                    html += this.createBrandSection(brandName, brochures, firstLetter);
                });
                
                container.innerHTML = html;
            }

            renderProductBrochures() {
                const container = document.querySelector('#product-content .brochures-container');
                const brands = this.data.productBrochures;
                
                let html = '';
                
                // Sort brands alphabetically
                const sortedBrands = Object.keys(brands).sort();
                
                sortedBrands.forEach(brandName => {
                    const brochures = brands[brandName];
                    const firstLetter = brandName.charAt(0).toUpperCase();
                    html += this.createBrandSection(brandName, brochures, firstLetter);
                });
                
                container.innerHTML = html;
            }

            createBrandSection(brandName, brochures, firstLetter) {
                let html = `
                    <div class="brochures-group" data-brand-letter="${firstLetter}">
                        <h2>${this.escapeHtml(brandName)} <span class="brochure-count">(${brochures.length})</span></h2>
                        <div class="brochures-list">
                `;
                
                brochures.forEach(brochure => {
                    html += `
                        <a href="${this.escapeHtml(brochure.url)}" target="_blank" class="brochure-link">
                            ${this.escapeHtml(brochure.title)}
                        </a>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
                
                return html;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showError(message) {
                const containers = document.querySelectorAll('.brochures-container');
                containers.forEach(container => {
                    container.innerHTML = `
                        <div class="error-message">
                            <h3>Error</h3>
                            <p>${message}</p>
                            <p>Please check the console for more details.</p>
                        </div>
                    `;
                });
            }
        }

        // Initialize the brochure manager when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new BrochureManager();
        });
    </script>
</body>
</html>
